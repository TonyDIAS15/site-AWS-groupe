<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>AWS Web Admin</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; }
    header { background: #232f3e; color: white; padding: 15px; text-align: center; }
    section { background: white; margin: 20px; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h2 { color: #232f3e; }
    button { background: #ff9900; border: none; color: white;
      padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-top: 5px; }
    button:hover { background: #cc7a00; }
    input, select { padding: 8px; margin: 5px 0; width: 100%;
      border: 1px solid #ccc; border-radius: 5px; }
    ul { list-style-type: none; padding: 0; }
    li { padding: 5px; background: #eee; margin: 5px 0; border-radius: 5px; }
  </style>
</head>
<body>
  <header>
    <h1>üåê AWS Web Admin</h1>
    <p>Gestion EC2 & S3</p>
  </header>

  <section>
    <h2>Instances EC2</h2>
    <button onclick="getEC2Instances()">Lister les instances</button>
    <ul id="ec2-list"></ul>
  </section>

  <section>
    <h2>Buckets S3</h2>
    <button onclick="getS3Buckets()">Lister les buckets</button>
    <ul id="s3-list"></ul>
  </section>

  <section>
    <h2>Cr√©er un Bucket & Uploader un fichier</h2>
    <form onsubmit="createBucket(event)">
      <label>Nom du Bucket :</label>
      <input type="text" id="bucketName" required>
      <label>Fichier √† uploader :</label>
      <input type="file" id="bucketFile">
      <button type="submit">Cr√©er et Uploader</button>
    </form>
  </section>

  <section>
    <h2>Supprimer un Bucket</h2>
    <form onsubmit="deleteBucket(event)">
      <label>Nom du Bucket √† supprimer :</label>
      <input type="text" id="deleteBucketName" required>
      <button type="submit">Supprimer</button>
    </form>
  </section>

  <script>
    async function getEC2Instances() {
      const res = await fetch('/api/ec2');
      const list = document.getElementById('ec2-list');
      list.innerHTML = '';
      if (!res.ok) {
        const error = await res.json();
        list.innerHTML = `<li style="color:red">Erreur: ${error.error}</li>`;
        return;
      }
      const data = await res.json();
      data.forEach(inst => {
        const li = document.createElement('li');
        li.textContent = `ID: ${inst.InstanceId} | State: ${inst.State}`;
        list.appendChild(li);
      });
    }

    async function getS3Buckets() {
      const res = await fetch('/api/s3');
      const data = await res.json();
      const list = document.getElementById('s3-list');
      list.innerHTML = '';
      data.forEach(bucket => {
        const li = document.createElement('li');
        li.textContent = `Bucket: ${bucket}`;
        list.appendChild(li);
      });
    }

    async function createBucket(event) {
      event.preventDefault();
      const name = document.getElementById('bucketName').value;
      const file = document.getElementById('bucketFile').files[0];
      let formData = new FormData();
      formData.append("bucketName", name);
      if (file) formData.append("file", file);
      const res = await fetch('/api/s3/create', { method: 'POST', body: formData });
      if (!res.ok) {
        const err = await res.json();
        alert("Erreur : " + err.error);
        return;
      }
      alert("Bucket cr√©√© !");
      getS3Buckets();
    }

    async function deleteBucket(event) {
      event.preventDefault();
      const name = document.getElementById('deleteBucketName').value;
      const res = await fetch(`/api/s3/${name}`, { method: 'DELETE' });
      if (!res.ok) {
        const err = await res.json();
        alert("Erreur : " + err.error);
        return;
      }
      alert("Bucket supprim√© !");
      getS3Buckets();
    }
  </script>
</body>
</html>
